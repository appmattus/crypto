/*
 * Copyright 2021 Appmattus Limited
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.appmattus.crypto.internal

import com.appmattus.crypto.Algorithm
import com.appmattus.crypto.internal.core.sphlib.strtobin
import com.appmattus.crypto.internal.core.sphlib.testHmac
import kotlin.test.Test

class HmacTigerTest {

    @Test
    fun misc2() {
        // From https://github.com/xsc/pandect/blob/master/test/pandect/hmac_test.clj

        testHmac(
            Algorithm.Tiger,
            "6b6579",
            "The quick brown fox jumps over the lazy dog",
            "fba544227e1471d8d47dd9d68c5008d554c6de6072ca2e2a"
        )

        // From https://github.com/bcgit/bc-java/blob/master/prov/src/test/java/org/bouncycastle/jce/provider/test/HMacTest.java

        testHmac(
            Algorithm.Tiger,
            "0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b",
            "Hi There",
            "1d7a658c75f8f004916e7b07e2a2e10aec7de2ae124d3647"
        )
    }

    @Test
    fun testTigerSeq() {
        val expectedOutput = listOf(
            "2EF793765716EE48A671BDB5F002103C43734304C8717C85",
            "AE61B56C82BE9FF96DCFBC20DD02B4BEA4FC6B6D5F4EC412",
            "B54ADBFB404457E6C5AFCCEC27199D1F259EE1994FFFE99F",
            "08AEEC38E88403BB854935EB6F1464CE95B044F4B4202524",
            "4C9DAEDC1929E22128F2A7ED5F3556D8A6D3A8315A7B556A",
            "764794ED9EE1F94891835CC3A361FE75C600C7951A07F450",
            "1A4C447A0FB8826A0881ED2E7BD89499EACA4B6C49F96060",
            "1396A21D8B465C6B898511DF94846588EE8E35C0095AD90A",
            "7552EB03CE26A8F079AC96B42F556FEAEB756014B8FDE622",
            "835B7CCA9D9F13BA2A36CBD746E5C92D5B2D123CA2EC848E",
            "7CF4EA88FF8B9A5A57E5ABB6B35278EE9D8653F624D662FE",
            "D588D953C6F438D077A1E302F84E25EF31AD99B9C5FC9DB4",
            "86EC62CF1A08CEA9171AC742E8E615B3F0C7B6FBC95DC3C8",
            "6EE7C51E26187F86370A26811C75136E28B0C39A113D80F8",
            "E1326D54123BC26CF41B30F9F2BA2E732203836AF8A74273",
            "F211E4C46862E3AC8B8E69976A705582CF6D1B34A6D342B7",
            "0C6160FEFE70C81C71B7465F42F070F30808CDAE448D1974",
            "492FC6BC091489F926F0F54CBF3E3F6C8CEC6ED14DF2DF8C",
            "FD166027ABD1BD9DBA13E3908D16C403E1691FF173328CA4",
            "28D99C64CDFFAC1E6F7B33C8E675E49749CE835A177A1C63",
            "FD7BD55BC2A684F4875C811143A2997356AA87A300345843",
            "DB8968E787BF65C00992ED9DDE974EA71BA947395111FFB3",
            "4C31B2FA4E6F7F40DECA589F85BB69BFAD1815A73CF9EB23",
            "B4D8D7FCB314942F171F85EA0953F7816DA9F07D72AF48B5",
            "9A6A70BAD76203A7A1F64D1EE34375EC8BCB21810ECE0B68",
            "D21D7E5EF6F1579C84428AB5D574468933BA037C9B0C34B6",
            "3C5292C87B24626241693F0EBE20A96800905691C5945E65",
            "350BEEC075258BA7FE0314E6803152B021570F067AE0D4D4",
            "6881F892886F9D66E68B937BB3A71FF5CB064611C722996E",
            "07831F1B2D00108386339F192729687B2F57B9DAB2B1210B",
            "38DE8DE8398EEC32939A239BC0198B0CFB18D12E4F2A3023",
            "5B683578F81867054089AE2E1B20E02B3BD92334CBB01FA9",
            "E30A80BE07651BA17E2DF0D43A583A9DB268DFF3AB7393ED",
            "42341B1EC4F61E90571188F5599FBA9ACF884B1E15694921",
            "7D98297D65F5FEA85CB967F22AE0707E03F305BF1D2249DD",
            "BC8EE5CE0FA8F9E6694406009EC9358BC420B7E5DE07B6F8",
            "B8095DE6770CB4CC2127FA672F93F39CA4AF0CCBB9805DDB",
            "20C0E981DF1B763B6BB47D43F66765AD434127C1FC55F829",
            "59795328D40D2CE6CFDED8DD5089F2D5B796C9438E7646CA",
            "0789CAB229AD54416C82CA5A2E667EC7CE66019FCACF766D",
            "F7C81B1AE705019FF9A9905972AFD72484A70E11FB81B278",
            "E72F52644BF5EE59BE87DF692EF0070D095115B7664BB53A",
            "B9A5DD984358D0B0F3C2781BA60E9BD3473C1C89C7982F23",
            "F7BA22269249759F1A87AEA0A125D4DF9B58E93714449008",
            "5D2257317F8978576CD7D2CCD346E861A59FE949F74A3D82",
            "199D8D5B0B5C5B61E046F50E0E389DA6F19CB3A7A37C8588",
            "F489CC6CB2D3E9F741D6C9008265CCA97E7E54D62F5EB85F",
            "A5E7CB0787EB7E62A9CFD8486390A6628C9876654B9E85E4",
            "22FA78EA17F0D29E16276C70A564D234BC4ECA7302301528",
            "4422534FB9EEC601CE7662345D6B6FF932E54BB0483C2F62",
            "5D2E2B90B460D393F36BF32B2F491E224EF388FA72A48501",
            "EA5287BCBB856BF04FC785541079087CE24783E9310F3090",
            "DEDA3920899FA69F913AE50A4F0D7119C9D3CE8F4E6D5BB2",
            "B2F55D8EA64C9842BFEA4FADFE616664CD44C57D53998C58",
            "3D2C72F26188E1EF5C0F0FC8B541224066C4DF455FEE78FF",
            "50BB36BD8A8D97E4D6CA78DDCDAD0690FBBC93DC9A66BF18",
            "48140E192FF8AB74FC22676AAAA186C1A7E2FA0166E986AC",
            "40AFD540C40EE7E598D26AE3FE5A47939299B5DD46B0B4FE",
            "CEBBBD763B077342BA16D4B20412C9EDE0F0508ABCE3501B",
            "0FE4DFE539160F5924C324B8B43DACB4F220195D286C6FA1",
            "A06D135075F943CEE74AAB1B8DE08B772055551B1E73ED48",
            "D4E1B5EBBDA5CDA5040DD697BB96DD702C6730CFCC012992",
            "BD5E77B67B42C507C4912130C8880A9DBD66431DCA0C0038",
            "D81F583A9B4DD1F48028CA602CC0F131D60561FA34F7B3B4",
            "A41F0481EE52842CDF676177F8E43BC1F1B00A5682C63E15",
            "CDB29E274ABEB20EECC8378D5BD806997502E4271AB56708",
            "B8366ABD45565BB3D26CE46B6F419F74B34851863FF4C336",
            "5AD2C193D6D51C9C7E56C5BFF55C1D61E045366B51E7F619",
            "9948E3AB7D121B15A6CA8DFDF4EE5377C957F0DE891C3575",
            "095676D61096853635128A80570BD1CE803AC7249C0A0F57",
            "354F4CCC1E5112770B2AB035AE07200A6CDC0280AD088AFB",
            "A8723395E80BED25DFE8F9ACEDA942A77D225D00440302D2",
            "0D2BCE0F8CF396FD8277C8BD9B19D54965308D3ED04D2F27",
            "54B1939E9944F499798B3DCE3479AC315F2C42A1EF231984",
            "5CFF726EE4B2596240E6CBBC66D7C737A4D12A702B40E81E",
            "82996D7F3F27B473BDA647BBBA7230DF217288F2D1A38B99",
            "CB95F63E0E7A2EC4F26E94B81A3C8C757E04EEEAB35A8C2A",
            "057DEDF45207EA885A0BAC5B64240DD21CB9D99CD8F38FEA",
            "27DCDD1ABA459506EF98E5C8D567692264C4153F91FDB269",
            "911C83660F7EE8CFB5F54890AE98CCA36C4C12B8CC771DF8",
            "67CD07209988C517FAEE01E64AC4B5CF261B6035069508FA",
            "D9A40C407E2BA852684770A5EB08D8502DFD264F2DE5A5FC",
            "9AAC50A2BCFD74BE3DF85237478AAA833484FA3DF912A3AC",
            "38078488F6183B5A94B655F24212FC9769450D93986C9208",
            "2EFFCBFA4CCCAFCA66BF8B368FB1FEFAC280C20416BB90EC",
            "D626FD6D285C49F20E99B88B9F82640D93D9E765CA55B5B0",
            "B1DD178943B26AA241D34031D3128344C6955F6A942CC5D3",
            "DA0C850E2067F9FDAE433C1230E0F629700FC8896ADDBDE9",
            "58E393E353BD7DF75A591904AA99526E94FA45C98D095E21",
            "323D0E04D239BD70192B2ACCB9ACF06E2F8C3B07565893AE",
            "F9C4147C6921640C097534BB08020540B420AD569D03665B",
            "5171DB964AC815B3A6D058419FD47833DDAED71039966E6D",
            "E7DC7C574AFC2C9A59E46CB8ADBD03330A5321B237DF7899",
            "97074CDA9FF8D40B0501E9F632ED7335D6A7926101A34C0C",
            "BDDCD4D007DE39680B80F9AF9803A9F21C836EA971250CD4",
            "0DBFF45E3155098D4B4C13815FB461D3C4BE41E9E1A68757",
            "FC16CB95478E4D23A7AD15CCAE3C24BBB3D0FBDC8A00A144",
            "93A7CB506481D6A72EAB14A2BA544F8631542B55903CCAAE",
            "9CC1FFA19736AB6EB36EB4A2C1624FCB6913B255D2346795",
            "CE3526A088FFEDEA4345AB221707848823B16DADD19AB487",
            "1E1D790323586DB8A306EDCCAC8C64A6F29A36F772B8D61D",
            "8C403515F2B9014E9519EC04769ACCF23E522D3E22DE7F41",
            "6B6A634607634804988301240CA5AB029A9E86E51281D64E",
            "C7C3483CC8E6B58520B554259EB08866AA7980B53FFB6B86",
            "96E429611C9E411321947469E2095CD9B0EF29578030E40F",
            "5C5A7F2B7F1F9BCE730BE2779304A443188FD3B31DD2BF19",
            "70933F999325353277E0AA1F543B5CBED3F28DAF4FC70A57",
            "5CD6D136FDDF4AE9CE42F008301FB6647096D5007E79973F",
            "1162BA742AD199AC17FC707285301A82BA9CB12C09BA229D",
            "C36615F6D5E29E6CABB7EBC44A6D3F7B024DAFBD338FEFFA",
            "C29FEF051D1606CEFCE3417BD571CB9188BBF0FA8AB98679",
            "F925144EDDD27244E19E4B6E433F312C6CDE43EF4F9B84B5",
            "C4230A59E54A34D0709F3F1DB02C18EC8AA270078DE424D5",
            "EB1699CAEC36681CCF8A9144DFB5050566042977D15FD1F9",
            "9FBF0D9B2DD9A6E87240E538590E9799B76E22604D22AB75",
            "2657EA06D69A78A5895A9169F849B3DE111B31E5673A8E17",
            "D1F9E1BA4F4E52CDAAFC388FA4C366EF4BD5F440608D86B0",
            "049196BFFD9F77175FA936066C3119293EAB79D1E0028C8F",
            "9CC1BD2CADDEC1D82FFAFA7031F2E5C9B6765CF1727A0ACB",
            "ED00438670D68A70CE2E0729997CC9648947EEA35809B8C7",
            "A520A0089BC16C84CB8E05425B330C6D261108EE3049FACF",
            "A55B470483E547D2752EDC3C4FDCF3B4C48A1990AD857941",
            "46A78E772C533EC8EDA60EB4A127FCEBD35E7D0E7F183241",
            "5EB9A774124D571FCCC83D1F36C603D9C387390DFB3928B2",
            "E904066FC77F73CA41166297A8FC631FF59634B659F0AED0",
            "B85B66AEF7D9904356F1CAA5583757D1D69EEBB8AB1D1420",
            "6639F85214BC798D71B757FCD480CB78D325881781A3A073",
            "C5B72BBE80917B55036A9AD6908D59293C49373F0BDD104B",
            "C0BD695F6B9B42DAB543C31BA73C9497A6AA6419A007A9F6"
        )

        var key = ByteArray(24) {
            it.toByte()
        }

        expectedOutput.forEachIndexed { index, output ->
            testHmac(
                Algorithm.Tiger,
                key,
                ByteArray(index) { it.toByte() },
                output
            )

            key = strtobin(output)
        }
    }
}
